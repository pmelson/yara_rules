rule panregex {
  meta:
    description = "Regex strings found in some POS malware families for PAN capture"
    author = "Paul Melson @pmelson (with lots of help from others)"
  strings:
    $mayberegex = "[0-9]"
    $genericpan = { 5b 30 2d 39 5d 7b 31 35 2c 31 39 7d }
    $amex0 = { 28 33 5b 34 7c 37 5d 5b 30 2d 39 5d 7b 31 33 7d 29 }
    $amex1 = { 28 00 33 00 5b 00 34 00 7c 00 37 00 5d 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 31 00 33 00 7d 00 29 }
    $discover0 = { 28 36 5b 30 2d 39 5d 7b 31 35 7d 29 }
    $discover1 = { 28 00 36 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 31 00 35 00 7d 00 29 }
    $mastercard0 = { 28 35 5b 31 2d 35 5d 5b 30 2d 39 5d 7b 31 34 7d 29 }
    $mastercard1 = { 28 00 35 00 5b 00 31 00 2d 00 35 00 5d 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 31 00 34 00 7d 00 29 }
    $visa0 = { 28 34 5b 30 2d 39 5d 7b 31 32 2c 31 38 7d 29 }
    $visa1 = { 28 00 34 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 31 00 32 00 2c 00 31 00 38 00 7d 00 29 }
    $blackpos0 = { 28 28 28 5b 34 7c 35 5d 5b 30 2d 39 5d 7b 31 35 7d 29 7c 28 5b 33 7c 36 5d 28 5b 30 2d 39 5d 29 7b 31 34 7d 29 29 5b 44 3d 5d 28 3f 3a 30 28 5b 37 2d 39 5d 29 7c 28 5b 31 2d 34 5d 5b 30 2d 39 5d 29 29 28 3f 3a 28 3f 3a 30 28 5b 31 2d 39 5d 29 29 7c 28 3f 3a 31 28 5b 30 2d 32 5d 29 29 29 28 5b 30 2d 39 5d 29 7b 38 2c 33 30 7d 29 }
    $alina0 = { 28 28 28 25 3f 5b 42 62 b4 60 5d 3f 29 5b 30 2d 39 5d 7b 31 33 2c 31 39 7d 5c 5e 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 32 36 7d 2f 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 32 36 7d 5c 5e 28 31 5b 32 2d 39 5d 29 28 30 5b 31 2d 39 5d 7c 31 5b 30 2d 32 5d 29 5b 30 2d 39 5c 73 5d 7b 33 2c 35 30 7d 5c 3f 29 5b 3b 5c 73 5d 7b 31 2c 33 7d 28 5b 30 2d 39 5d 7b 31 33 2c 31 39 7d 3d 28 31 5b 32 2d 39 5d 29 28 30 5b 31 2d 39 5d 7c 31 5b 30 2d 32 5d 29 5b 30 2d 39 5d 7b 33 2c 35 30 7d 5c 3f 29 29 }
    $alina1 = { 28 5b 30 2d 39 5d 7b 31 33 2c 31 39 7d 3d 28 31 5b 32 2d 39 5d 29 28 30 5b 31 2d 39 5d 7c 31 5b 30 2d 32 5d 29 5b 30 2d 39 5d 7b 33 2c 35 30 7d 5c 3f 29 }
    $alina2 = { 28 28 25 3f 5b 42 62 b4 60 5d 3f 29 5b 30 2d 39 5d 7b 31 33 2c 31 39 7d 5c 5e 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 32 36 7d 2f 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 32 36 7d 5c 5e 28 31 5b 32 2d 39 5d 29 28 30 5b 31 2d 39 5d 7c 31 5b 30 2d 32 5d 29 5b 30 2d 39 5c 73 5d 7b 33 2c 35 30 7d 5c 3f 29 }
    $alina3 = { 28 28 28 25 3f 5b 42 62 5d 29 5b 30 2d 39 5d 7b 31 33 2c 31 39 7d 5c 5e 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 32 36 7d 2f 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 32 36 7d 5c 5e 28 31 5b 32 2d 39 5d 29 28 30 5b 31 2d 39 5d 7c 31 5b 30 2d 32 5d 29 5b 30 2d 39 5c 73 5d 7b 33 2c 35 30 7d 5c 3f 29 5b 3b 20 5d 7b 31 2c 33 7d 28 5b 30 2d 39 5d 7b 31 33 2c 31 39 7d 3d 28 31 5b 32 2d 39 5d 29 28 30 5b 31 2d 39 5d 7c 31 5b 30 2d 32 5d 29 5b 30 2d 39 5d 7b 33 2c 35 30 7d 5c 3f 29 29 }
    $alina4 = { 28 28 25 3f 5b 42 62 5d 29 5b 30 2d 39 5d 7b 31 33 2c 31 39 7d 5c 5e 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 32 36 7d 2f 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 32 36 7d 5c 5e 28 31 5b 32 2d 39 5d 29 28 30 5b 31 2d 39 5d 7c 31 5b 30 2d 32 5d 29 5b 30 2d 39 5c 73 5d 7b 33 2c 35 30 7d 5c 3f 29 }
    $alina5 = { 7b 5b 21 31 37 21 5d 7d 7b 5b 21 31 38 21 5d 7d }
    $alina_kitten1 = "((%?[Bb`]?)[0-9]{13,19}\\^[A-Za-z\\s]{0,26}/[A-Za-z\\s]{0,26}\\^(1[2-9])(0[1-9]|1[0-2])[0-9\\s]{3,50}\\?)" wide ascii
    $alina_kitten2 = "(((%?[Bb`]?)[0-9]{13,19}\\^[A-Za-z\\s]{0,26}/[A-Za-z\\s]{0,26}\\^(1[2-9])(0[1-9]|1[0-2])[0-9\\s]{3,50}\\?)[;\\s]{1,3}([0-9]{13,19}=(1[2-9])(0[1-9]|1[0-2])[0-9]{3,50}\\?))" wide ascii
    $centerpos0 = { 28 00 28 00 28 00 25 00 3f 00 5b 00 42 00 62 00 5d 00 3f 00 29 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 31 00 33 00 2c 00 31 00 39 00 7d 00 5c 00 5e 00 5b 00 41 00 2d 00 5a 00 61 00 2d 00 7a 00 5c 00 73 00 5d 00 7b 00 30 00 2c 00 32 00 36 00 7d 00 5c 00 2f 00 5b 00 41 00 2d 00 5a 00 61 00 2d 00 7a 00 5c 00 73 00 5d 00 7b 00 30 00 2c 00 32 00 36 00 7d 00 5c 00 5e 00 28 00 31 00 5b 00 33 00 2d 00 39 00 5d 00 7c 00 32 00 5b 00 30 00 2d 00 39 00 5d 00 29 00 28 00 30 00 5b 00 31 00 2d 00 39 00 5d 00 7c 00 31 00 5b 00 30 00 2d 00 32 00 5d 00 29 00 5b 00 30 00 2d 00 39 00 5c 00 73 00 5d 00 7b 00 33 00 2c 00 35 00 30 00 7d 00 5c 00 3f 00 29 00 5b 00 3b 00 5c 00 73 00 5d 00 7b 00 31 00 2c 00 33 00 7d 00 28 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 31 00 33 00 2c 00 31 00 39 00 7d 00 3d 00 28 00 31 00 5b 00 33 00 2d 00 39 00 5d 00 7c 00 32 00 5b 00 30 00 2d 00 39 00 5d 00 29 00 28 00 30 00 5b 00 31 00 2d 00 39 00 5d 00 7c 00 31 00 5b 00 30 00 2d 00 32 00 5d 00 29 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 33 00 2c 00 35 00 30 00 7d 00 5c 00 3f 00 29 } 
    $centerpos1 = { 28 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 31 00 33 00 2c 00 31 00 39 00 7d 00 3d 00 28 00 31 00 5b 00 32 00 2d 00 39 00 5d 00 7c 00 32 00 5b 00 30 00 2d 00 39 00 5d 00 29 00 28 00 30 00 5b 00 31 00 2d 00 39 00 5d 00 7c 00 31 00 5b 00 30 00 2d 00 32 00 5d 00 29 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 33 00 2c 00 35 00 30 00 7d 00 5c 00 3f 00 29 }
    $centerpos2 = { 28 00 28 00 25 00 3f 00 5b 00 42 00 62 00 5d 00 3f 00 29 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 31 00 33 00 2c 00 31 00 39 00 7d 00 5c 00 5e 00 5b 00 41 00 2d 00 5a 00 61 00 2d 00 7a 00 5c 00 73 00 5d 00 7b 00 30 00 2c 00 32 00 36 00 7d 00 5c 00 2f 00 5b 00 41 00 2d 00 5a 00 61 00 2d 00 7a 00 5c 00 73 00 5d 00 7b 00 30 00 2c 00 32 00 36 00 7d 00 5c 00 5e 00 28 00 31 00 5b 00 32 00 2d 00 39 00 5d 00 7c 00 32 00 5b 00 30 00 2d 00 39 00 5d 00 29 00 28 00 30 00 5b 00 31 00 2d 00 39 00 5d 00 7c 00 31 00 5b 00 30 00 2d 00 32 00 5d 00 29 00 5b 00 30 00 2d 00 39 00 5c 00 73 00 5d 00 7b 00 33 00 2c 00 35 00 30 00 7d 00 5c 00 3f 00 29 }
    $centerpos3 = { 28 28 28 25 3f 5b 42 62 5d 3f 29 5b 30 2d 39 5d 7b 31 33 2c 31 39 7d 5c 5e 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 32 36 7d 5c 2f 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 32 36 7d 5c 5e 28 31 5b 33 2d 39 5d 7c 32 5b 30 2d 39 5d 29 28 30 5b 31 2d 39 5d 7c 31 5b 30 2d 32 5d 29 5b 30 2d 39 5c 73 5d 7b 33 2c 35 30 7d 5c 3f 29 5b 3b 5c 73 5d 7b 31 2c 33 7d 28 5b 30 2d 39 5d 7b 31 33 2c 31 39 7d 3d 28 31 5b 33 2d 39 5d 7c 32 5b 30 2d 39 5d 29 28 30 5b 31 2d 39 5d 7c 31 5b 30 2d 32 5d 29 5b 30 2d 39 5d 7b 33 2c 35 30 7d 5c 3f 29 29 }
    $centerpos4 = { 28 5b 30 2d 39 5d 7b 31 33 2c 31 39 7d 3d 28 31 5b 32 2d 39 5d 7c 32 5b 30 2d 39 5d 29 28 30 5b 31 2d 39 5d 7c 31 5b 30 2d 32 5d 29 5b 30 2d 39 5d 7b 33 2c 35 30 7d 5c 3f 29 }
    $centerpos5 = { 28 28 25 3f 5b 42 62 5d 3f 29 5b 30 2d 39 5d 7b 31 33 2c 31 39 7d 5c 5e 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 32 36 7d 5c 2f 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 32 36 7d 5c 5e 28 31 5b 32 2d 39 5d 7c 32 5b 30 2d 39 5d 29 28 30 5b 31 2d 39 5d 7c 31 5b 30 2d 32 5d 29 5b 30 2d 39 5c 73 5d 7b 33 2c 35 30 7d 5c 3f 29 }
    $chewbaccapos0 = { 28 5b 30 2d 39 5d 7b 31 33 2c 31 39 7d 5b 5c 5e 5d 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 33 30 7d 5b 5c 2f 5d 5b 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 33 30 7d  5b 5c 5e 5d 28 5b 30 2d 39 5c 73 5d 7b 31 2c 37 30 7d 29 5c 3f 29 }
    $chewbaccapos1 = { 28 5b 30 2d 39 5d 7b 31 33 2c 31 39 7d 5b 3d 44 5d 5b 30 2d 39 5d 7b 35 2c 35 30 7d 29 5c 3f }
    $diablo_horn = { 43 43 4d 5b 30 2d 39 5d 7b 31 35 2c 31 39 7d 44 5b 30 2d 39 5d 7b 34 7d }
    $fighterpos0 = { 28 28 62 7c 42 29 5b 30 2d 39 5d 7b 31 33 2c 31 39 7d 5c 5e 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 33 30 7d 5c 2f 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 33 30 7d 5c 5e 28 30 5b 37 2d 39 5d 7c 31 5b 30 2d 35 5d 29 28 28 30 5b 31 2d 39 5d 29 7c 28 31 5b 30 2d 32 5d 29 29 5b 30 2d 39 5c 73 5d 7b 33 2c 35 30 7d 5b 30 2d 39 5d 7b 31 7d 29 }
    $fighterpos1 = { 28 5b 30 2d 39 5d 7b 31 35 2c 31 36 7d 5b 44 3d 5d 28 30 5b 37 2d 39 5d 7c 31 5b 30 2d 35 5d 29 28 28 30 5b 31 2d 39 5d 29 7c 28 31 5b 30 2d 32 5d 29 29 5b 30 2d 39 5d 7b 38 2c 33 30 7d 29 }
    $findpos_packer = "sz=[0-9]*"
    $hydrapos = { 28 00 5b 00 33 00 2d 00 36 00 5d 00 5b 00 30 00 2d 00 39 00 5d 00 5c 00 64 00 7b 00 31 00 32 00 2c 00 31 00 34 00 7d 00 3d 00 28 00 5b 00 30 00 2d 00 39 00 5d 00 5c 00 64 00 7b 00 31 00 7d 00 29 00 28 00 5b 00 30 00 2d 00 39 00 5d 00 5c 00 64 00 7b 00 31 00 7d 00 29 00 28 00 5b 00 30 00 2d 00 39 00 5d 00 5c 00 64 00 7b 00 32 00 7d 00 29 00 5b 00 30 00 2d 00 39 00 5d 00 5c 00 64 00 7b 00 33 00 2c 00 31 00 32 00 7d 00 29 }
    $malumpos0 = { 28 28 62 7c 42 29 5b 30 2d 39 5d 7b 31 33 2c 31 39 7d 5c 5e 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 33 30 7d 5c 2f 5b 41 2d 5a 61 2d 7a 5c 73 5d 7b 30 2c 33 30 7d 5c 5e 28 31 5b 31 2d 39 5d 29 28 28 30 5b 31 2d 39 5d 29 7c 28 31 5b 30 2d 32 5d 29 29 5b 30 2d 39 5c 73 5d 7b 33 2c 35 30 7d 5b 30 2d 39 5d 7b 31 7d 29 }
    $malumpos1 = { 28 5b 33 2d 39 5d 7b 31 7d 5b 30 2d 39 5d 7b 31 34 2c 31 35 7d 5b 44 3d 5d 28 31 5b 31 2d 39 5d 29 28 28 30 5b 31 2d 39 5d 29 7c 28 31 5b 30 2d 32 5d 29 29 5b 30 2d 39 5d 7b 38 2c 33 30 7d 29 }
    $powershell_dump= "(4[0-9]{15}|5[1-5][0-9]{14}|3[47][0-9]{13}|6(?:011|5[0-9]{2})[0-9]{12})" wide ascii
    $rawpos0 = { 28 28 42 28 28 5b 30 2d 39 5d 7b 31 33 2c 31 36 7d 29 7c 28 5b 30 2d 39 5d 7c 5c 73 29 7b 31 33 2c 32 35 7d 29 5c 5e 5b 41 2d 5a 5c 73 30 2d 39 5d 7b 30 2c 33 30 7d 5c 2f 5b 41 2d 5a 5c 73 30 2d 39 5d 7b 30 2c 33 30 7d 5c 5e }
    $rawpos1 = { 28 42 28 28 5b 30 2d 39 5d 7b 31 33 2c 31 36 7d 29 7c 28 5b 30 2d 39 5d 7c 5c 73 29 7b 31 33 2c 32 35 7d 29 5c 5e 5b 41 2d 5a 5c 73 30 2d 39 5d 7b 30 2c 33 30 7d 5c 2f 5b 41 2d 5a 5c 73 30 2d 39 5d 7b 30 2c 33 30 7d 5c 5e 5b 30 2d 39 5d 7b 32 7d 28 28 30 5b 31 2d 39 5d 29 7c 28 31 5b 30 2d 32 5d 29 29 28 5b 30 2d 39 5d 7c 5c 73 29 7b 33 2c 35 30 7d 29 7c 28 5b 30 2d 39 5d 7b 31 35 2c 31 36 7d 28 44 7c 3d 29 5b 30 2d 39 5d 7b 32 7d 28 28 30 5b 31 2d 39 5d 29 7c 28 31 5b 30 2d 32 5d 29 29 5b 30 2d 39 5d 7b 38 2c 33 30 7d 29 }
    $rawpos2 = { 28 42 28 28 5b 30 2d 39 5d 7b 31 33 2c 31 36 7d 29 7c 28 5b 30 2d 39 5d 7c 5c 73 29 7b 31 33 2c 32 35 7d 29 5c 5e 5b 41 2d 5a 5c 73 30 2d 39 5d 7b 30 2c 33 30 7d 5c 2f 5b 41 2d 5a 5c 73 30 2d 39 5d 7b 30 2c 33 30 7d 5c 5e 5b 30 2d 39 5d 7b 32 7d 28 28 30 5b 31 2d 39 5d 29 7c 28 31 5b 30 2d 32 5d 29 29 28 5b 30 2d 39 5d 7c 5c 73 29 7b 33 2c 35 30 7d 29 7c 28 5b 33 2d 37 5d 5b 30 2d 39 5d 7b 31 34 2c 31 35 7d 28 44 7c 3d 29 5b 30 2d 39 5d 7b 32 7d 28 28 30 5b 31 2d 39 5d 29 7c 28 31 5b 30 2d 32 5d 29 29 5b 30 2d 39 5d 7b 38 2c 33 30 7d 29 29 }
    $rawpos3 = { 28 42 28 28 5b 30 2d 39 5d 7b 31 33 2c 31 36 7d 29 7c 28 5b 30 2d 39 5d 7c 73 29 7b 31 33 2c 32 35 7d 29 5c 5e 5b 41 2d 5a 5c 73 30 2d 39 5d 7b 30 2c 33 30 7d 5c 2f 5b 41 2d 5a 5c 73 30 2d 39 5d 7b 30 2c 33 30 7d 5c 5e 28 30 5b 37 2d 39 5d 7c 31 5b 30 2d 35 5d 29 28 28 30 5b 31 2d 39 5d 29 7c 28 31 5b 30 2d 32 5d 29 29 28 5b 30 2d 39 5d 7c 5c 73 29 7b 33 2c 35 30 7d 29 }
    $rawpos4 = { 28 5b 30 2d 39 5d 7b 31 35 2c 31 36 7d 3d 28 30 5b 37 2d 39 5d 7c 31 5b 30 2d 35 5d 29 28 28 30 5b 31 2d 39 5d 29 7c 28 31 5b 30 2d 32 5d 29 29 5b 30 2d 39 5d 7b 38 2c 33 30 7d 29 }
    $rawpos5 = { 28 28 42 28 28 5b 30 2d 39 5d 7b 31 33 2c 31 36 7d 29 7c 28 5b 30 2d 39 5d 7c 73 29 7b 31 33 2c 32 35 7d 29 5c 5e 5b 41 2d 5a 5c 73 30 2d 39 5d 7b 30 2c 33 30 7d 5c 2f 5b 41 2d 5a 5c 73 30 2d 39 5d 7b 30 2c 33 30 7d 5c 5e 28 30 5b 37 2d 39 5d 7c 31 5b 30 2d 35 5d 29 28 28 30 5b 31 2d 39 5d 29 7c 28 31 5b 30 2d 32 5d 29 29 28 5b 30 2d 39 5d 7c 5c 73 29 7b 33 2c 35 30 7d 29 7c 28 5b 30 2d 39 5d 7b 31 35 2c 31 36 7d 3d 28 30 5b 37 2d 39 5d 7c 31 5b 30 2d 35 5d 29 28 28 30 5b 31 2d 39 5d 29 7c 28 31 5b 30 2d 32 5d 29 29 5b 30 2d 39 5d 7b 38 2c 33 30 7d 29 29 }
    $rawpos6 = "([0-9]|\\s){13,25})\\^[A-Z\\s0-9]{0,30}\\/[A-Z\\s0-9]{0,30}\\^[0-9]{2}((0[1-9])"
    $rawpos7 = { 28 5b 44 64 5d 72 69 76 65 72 73 2e 5b 4c 6c 5d 69 63 65 6e 73 65 29 29 }
    $vskimmer0 = { 5c 3b 3f 5b 33 2d 39 5d 7b 31 7d 5b 30 2d 39 5d 7b 31 32 2c 31 39 7d 5b 44 3d 5c 75 30 30 36 31 5d 5b 30 2d 39 5d 7b 31 30 2c 33 30 7d 5c 3f 3f }
    $xpctra0 = { 28 00 28 00 25 00 25 00 3f 00 5b 00 42 00 62 00 60 00 5d 00 3f 00 29 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 31 00 33 00 2c 00 31 00 39 00 7d 00 5c 00 5e 00 5b 00 41 00 2d 00 5a 00 61 00 2d 00 7a 00 5c 00 73 00 5d 00 7b 00 30 00 2c 00 32 00 36 00 7d 00 5c 00 2f 00 5b 00 41 00 2d 00 5a 00 61 00 2d 00 7a 00 5c 00 73 00 5d 00 7b 00 30 00 2c 00 32 00 36 00 7d 00 5c 00 5e 00 28 00 31 00 5b 00 32 00 2d 00 39 00 5d 00 7c 00 32 00 5b 00 30 00 2d 00 39 00 5d 00 29 00 28 00 30 00 5b 00 31 00 2d 00 39 00 5d 00 7c 00 31 00 5b 00 30 00 2d 00 32 00 5d 00 29 00 5b 00 30 00 2d 00 39 00 5c 00 73 00 5d 00 7b 00 33 00 2c 00 35 00 30 00 7d 00 5c 00 3f 00 29 }
    $xpctra1 = { 28 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 31 00 33 00 2c 00 31 00 39 00 7d 00 3d 00 28 00 31 00 5b 00 32 00 2d 00 39 00 5d 00 7c 00 32 00 5b 00 30 00 2d 00 39 00 5d 00 29 00 28 00 30 00 5b 00 31 00 2d 00 39 00 5d 00 7c 00 31 00 5b 00 30 00 2d 00 32 00 5d 00 29 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 33 00 2c 00 35 00 30 00 7d 00 29 }
    $xpctra2 = { 28 00 28 00 25 00 25 00 3f 00 5b 00 42 00 62 00 60 00 5d 00 3f 00 29 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 31 00 33 00 2c 00 31 00 39 00 7d 00 5c 00 5e 00 5b 00 41 00 2d 00 5a 00 61 00 2d 00 7a 00 5c 00 73 00 5d 00 7b 00 30 00 2c 00 32 00 36 00 7d 00 5c 00 2f 00 5b 00 41 00 2d 00 5a 00 61 00 2d 00 7a 00 5c 00 73 00 5d 00 7b 00 30 00 2c 00 32 00 36 00 7d 00 5c 00 5e 00 28 00 31 00 5b 00 32 00 2d 00 39 00 5d 00 7c 00 32 00 5b 00 30 00 2d 00 39 00 5d 00 29 00 28 00 30 00 5b 00 31 00 2d 00 39 00 5d 00 7c 00 31 00 5b 00 30 00 2d 00 32 00 5d 00 29 00 5b 00 30 00 2d 00 39 00 5c 00 73 00 5d 00 7b 00 33 00 2c 00 35 00 30 00 7d 00 5c 00 3f 00 29 00 5b 00 3b 00 5c 00 73 00 5d 00 7b 00 31 00 2c 00 33 00 7d 00 28 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 31 00 33 00 2c 00 31 00 39 00 7d 00 3d 00 28 00 31 00 5b 00 32 00 2d 00 39 00 5d 00 7c 00 32 00 5b 00 30 00 2d 00 39 00 5d 00 29 00 28 00 30 00 5b 00 31 00 2d 00 39 00 5d 00 7c 00 31 00 5b 00 30 00 2d 00 32 00 5d 00 29 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 33 00 2c 00 35 00 30 00 7d 00 5c 00 3f 00 29 00 29 }
    $xpctra3 = { 28 00 28 00 25 00 25 00 3f 00 5b 00 42 00 62 00 60 00 5d 00 3f 00 29 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 31 00 33 00 2c 00 31 00 39 00 7d 00 5c 00 5e 00 5b 00 41 00 2d 00 5a 00 61 00 2d 00 7a 00 5c 00 73 00 5d 00 7b 00 30 00 2c 00 32 00 36 00 7d 00 5c 00 2f 00 5b 00 41 00 2d 00 5a 00 61 00 2d 00 7a 00 5c 00 73 00 5d 00 7b 00 30 00 2c 00 32 00 36 00 7d 00 5c 00 5e 00 28 00 31 00 5b 00 32 00 2d 00 39 00 5d 00 7c 00 32 00 5b 00 30 00 2d 00 39 00 5d 00 29 00 28 00 30 00 5b 00 31 00 2d 00 39 00 5d 00 7c 00 31 00 5b 00 30 00 2d 00 32 00 5d 00 29 00 5b 00 30 00 2d 00 39 00 5c 00 73 00 5d 00 7b 00 33 00 2c 00 35 00 30 00 7d 00 5c 00 3f 00 29 00 70 28 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 31 00 33 00 2c 00 31 00 39 00 7d 00 3d 00 28 00 31 00 5b 00 32 00 2d 00 39 00 5d 00 7c 00 32 00 5b 00 30 00 2d 00 39 00 5d 00 29 00 28 00 30 00 5b 00 31 00 2d 00 39 00 5d 00 7c 00 31 00 5b 00 30 00 2d 00 32 00 5d 00 29 00 5b 00 30 00 2d 00 39 00 5d 00 7b 00 33 00 2c 00 35 00 30 00 7d 00 29 }
  condition:
    any of them
}

rule luhn {
  meta:
    description = "Luhn check (mod10) opcodes found in some POS malware families"
    author = "Paul Melson @pmelson (with lots of help from others)"
  strings:
    $getmypass_luhn = { C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? 8B ?? ?? ?? ?? ?? EB ?? ?? ?? 83 ?? ?? ?? ?? ?? ?? ?? ?? ?? 8B ?? ?? 8B ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 74 ?? 8B ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 83 ?? ?? ?? 74 ?? 8B ?? ?? ?? ?? ?? EB ?? 8B ?? ?? 8B ?? ?? ?? ?? ?? ?? 8B ?? ?? ?? ?? ?? ?? ?? ?? EB ?? 8B ?? ?? ?? B9 }
    $dexter_luhn = { C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? EB ?? ?? ?? 83 ?? ?? ?? ?? ?? ?? ?? ?? ?? 8B ?? ?? 8B ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 74 ?? 8B ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 83 ?? ?? ?? 74 ?? 8B ?? ?? ?? ?? ?? EB ?? 8B ?? ?? 8B ?? ?? ?? ?? ?? ?? 8B ?? ?? ?? ?? ?? ?? ?? ?? EB ?? 8B ?? ?? ?? B9 }
    $fin7_poslog_luhn = { C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? 8B ?? ?? ?? ?? ?? EB ?? ?? ?? 83 ?? ?? ?? ?? ?? ?? ?? ?? ?? 8B ?? ?? 8B ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 74 ?? 8B ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 83 ?? ?? ?? 74 ?? 8B ?? ?? ?? ?? ?? EB ?? 8B ?? ?? 8B ?? ?? ?? ?? ?? ?? 8B ?? ?? ?? ?? ?? ?? ?? ?? EB ?? 8B ?? ?? ?? B9 }
    $frameworkpos_luhn_prologue = { B8 67 66 66 66 F7 EE C1 FA 02 8B CA C1 E9 1F 03 CA 5F 8D 0C 89 03 C9 2B F1 8B 4D FC F7 DE 1B F6 33 CD 8D 46 01 5E 5B }
    $frameworkpos_luhn = { 48 ?? ?? ?? ?? 48 ?? ?? ?? ?? ?? ?? 48 ?? ?? ?? ?? ?? ?? ?? ?? ?? 48 ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? 48 ?? ?? ?? ?? ?? ?? ?? E8 ?? ?? ?? ?? ?? ?? ?? ?? EB ?? 83 ?? ?? ?? ?? 75 ?? C7 ?? ?? ?? ?? ?? ?? ?? EB ?? C7 ?? ?? ?? ?? ?? ?? ?? 8B ?? ?? ?? ?? ?? ?? ?? 8B ?? ?? ?? 8B ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 74 ?? ?? ?? ?? ?? ?? 48 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 83 ?? ?? ?? ?? ?? ?? 83 ?? ?? ?? ?? 74 ?? 8B ?? ?? ?? ?? ?? ?? ?? EB ?? ?? ?? ?? ?? ?? 8B ?? ?? ?? ?? ?? ?? ?? 8B ?? ?? ?? 8B ?? ?? ?? ?? ?? 8B C1 ?? ?? ?? ?? EB ?? 8B ?? ?? ?? ?? B9 ?? ?? ?? ?? ?? ?? 8B C2 ?? ?? 75 ?? C7 ?? ?? ?? ?? ?? ?? ?? EB }
    $logpos_luhn = { C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? 8B ?? ?? ?? ?? ?? EB ?? 8B ?? ?? 8B ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 83 ?? ?? ?? 74 ?? 8B ?? ?? EB ?? 8B ?? ?? 8B ?? ?? ?? ?? ?? ?? 83 ?? ?? ?? 75 ?? B? ?? ?? ?? ?? EB ?? B? ?? ?? ?? ?? ?? ?? ?? 8B ?? ?? ?? ?? ?? ?? ?? ?? 83 ?? ?? 75 ?? 8B ?? ?? B? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 83 ?? ?? 75 ?? B? ?? ?? ?? ?? EB }
    $mozartpos_luhn = { C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 75 ?? ?? ?? 8B ?? 74 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 75 ?? 8B ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 8B ?? 75 ?? 8B ?? ?? B9 ?? ?? ?? ?? ?? ?? 5? 5? 5? 5? 8B }
    $n3utrino_luhn = { C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? C7 ?? ?? ?? ?? ?? ?? 8B ?? ?? 89 ?? ?? EB ?? ?? ?? 83 ?? ?? ?? ?? ?? ?? 89 ?? ?? 8B ?? ?? 8B ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? 74 ?? 8B ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 89 ?? ?? 83 ?? ?? ?? 74 ?? 8B ?? ?? 89 ?? ?? EB ?? 8B ?? ?? 8B ?? ?? ?? 89 ?? ?? 8B ?? ?? ?? ?? ?? 89 ?? ?? EB }
  condition:
    any of them
}
